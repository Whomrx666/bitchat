# Obfuscated by Mr.X
import base64
exec(base64.b64decode('IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIgQml0Y2hhdCBWMS40IOKAlCBDeWJlcnB1bmsgRWRpdGlvbiDimqEgRml0dXI6CgotIEF1dG8tZGlzY292ZXIgc2VydmVyCi0gQWRtaW4gY2hhdCBzZWJhZ2FpIFthZG1pbl0gTmljawotIEtpY2sgdXNlciwgbm90aWYga2VsdWFyLCBkYW4gdGVtYSB3YXJuYQotIC9oZWxwIHVudHVrIHBldHVuanVrIHBlcmludGFoCiIiIgppbXBvcnQgc29ja2V0CmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IGFyZ3BhcnNlCmltcG9ydCBqc29uCmltcG9ydCBvcwppbXBvcnQgdGltZQppbXBvcnQgcmFuZG9tCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aAoKIyBPcHRpb25hbCBVSSBsaWJzCnRyeToKICAgIGZyb20gY29sb3JhbWEgaW1wb3J0IEZvcmUsIFN0eWxlLCBpbml0IGFzIGNvbG9yYW1hX2luaXQKICAgIGNvbG9yYW1hX2luaXQoYXV0b3Jlc2V0PVRydWUpCmV4Y2VwdCBFeGNlcHRpb246CiAgICBjbGFzcyBfRDoKICAgICAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbik6CiAgICAgICAgICAgIHJldHVybiAiIgogICAgRm9yZSA9IFN0eWxlID0gX0QoKQoKdHJ5OgogICAgaW1wb3J0IHB5ZmlnbGV0CmV4Y2VwdCBFeGNlcHRpb246CiAgICBweWZpZ2xldCA9IE5vbmUKCiMgPT09PT0gY29uZmlnID09PT09ClZFUlNJT04gPSAiVjEiCkNIQVRfUE9SVCA9IDUwMDcKRElTQ19QT1JUID0gNTAwOApESVNDX1RJTUVPVVQgPSA0CkRJU0NfSU5URVJWQUwgPSAyClNBVkVfRklMRSA9ICJjaGF0X2hpc3RvcnkuanNvbiIKTklDS19GSUxFID0gIm5pY2tuYW1lLnR4dCIKVEhFTUVfRklMRSA9ICJ0aGVtZS50eHQiCkRJU0NfTUFHSUMgPSAiQml0Y2hhdFNlcnZlclYxIgoKIyA9PT09PSBUSEVNRVMgPT09PT0KIyB0dXBsZTogKGRpc3BsYXlfbmFtZSwgdGl0bGVfY29sb3IsIGluZm9fY29sb3IsIG1zZ19jb2xvciwgc3lzdGVtX2NvbG9yLCBhY2NlbnQpClRIRU1FUyA9IHsKICAgICIxIjogKCJDbGFzc2ljIiwgRm9yZS5DWUFOLCBGb3JlLkdSRUVOLCBGb3JlLllFTExPVywgRm9yZS5NQUdFTlRBLCBGb3JlLldISVRFKSwKICAgICIyIjogKCJOZW9uIEN5YmVycHVuayIsIEZvcmUuTUFHRU5UQSwgRm9yZS5DWUFOLCBGb3JlLllFTExPVywgRm9yZS5SRUQsIEZvcmUuTElHSFRCTEFDS19FWCksCiAgICAiMyI6ICgiTWF0cml4IiwgRm9yZS5HUkVFTiwgRm9yZS5MSUdIVEdSRUVOX0VYLCBGb3JlLldISVRFLCBGb3JlLlJFRCwgRm9yZS5MSUdIVEJMQUNLX0VYKSwKICAgICI0IjogKCJPY2VhbiIsIEZvcmUuQ1lBTiwgRm9yZS5CTFVFLCBGb3JlLkxJR0hUQ1lBTl9FWCwgRm9yZS5ZRUxMT1csIEZvcmUuTElHSFRCTEFDS19FWCksCiAgICAiNSI6ICgiUmV0cm8iLCBGb3JlLllFTExPVywgRm9yZS5MSUdIVFlFTExPV19FWCwgRm9yZS5XSElURSwgRm9yZS5SRUQsIEZvcmUuTElHSFRCTEFDS19FWCksCn0KREVGQVVMVF9USEVNRV9LRVkgPSAiMiIgICMgZGVmYXVsdCB0byBOZW9uIEN5YmVycHVuawpfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKCiMgPT09PT0gSGVscGVyID09PT09CmRlZiBub3dfdHMoZm10PSIlWS0lbS0lZCAlSDolTTolUyIpOgogICAgcmV0dXJuIGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKGZtdCkKCmRlZiBlbnN1cmVfZGlyX2ZvcihmbmFtZSk6CiAgICBQYXRoKGZuYW1lKS5wYXJlbnQubWtkaXIocGFyZW50cz1UcnVlLCBleGlzdF9vaz1UcnVlKQoKZGVmIHNhdmVfbWVzc2FnZV9sb2NhbChlbnRyeSk6CiAgICBlbnN1cmVfZGlyX2ZvcihTQVZFX0ZJTEUpCiAgICB0cnk6CiAgICAgICAgY2hhdCA9IFtdCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU0FWRV9GSUxFKToKICAgICAgICAgICAgd2l0aCBvcGVuKFNBVkVfRklMRSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNoYXQgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBjaGF0ID0gW10KICAgICAgICBjaGF0LmFwcGVuZChlbnRyeSkKICAgICAgICB3aXRoIG9wZW4oU0FWRV9GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGpzb24uZHVtcChjaGF0LCBmLCBpbmRlbnQ9MiwgZW5zdXJlX2FzY2lpPUZhbHNlKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBleHBvcnRfY2hhdF9maWxlKCk6CiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoU0FWRV9GSUxFKToKICAgICAgICBwcmludCgi4p2MIEJlbHVtIGFkYSByaXdheWF0IHVudHVrIGRpc2ltcGFuLiIpCiAgICAgICAgcmV0dXJuCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKFNBVkVfRklMRSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBjaGF0ID0ganNvbi5sb2FkKGYpCiAgICAgICAgZm5hbWUgPSAic2F2ZWRfY2hhdC50eHQiCiAgICAgICAgd2l0aCBvcGVuKGZuYW1lLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoIj09PSBCSVRDSEFUIEVYUE9SVCA9PT1cbiIpCiAgICAgICAgICAgIGYud3JpdGUoZiJFeHBvcnRlZCBvbjoge25vd190cygpfVxuIikKICAgICAgICAgICAgZi53cml0ZSgiPT09PT09PT09PT09PT09PT09PT09PVxuXG4iKQogICAgICAgICAgICBmb3IgZSBpbiBjaGF0OgogICAgICAgICAgICAgICAgZi53cml0ZShmIlt7ZS5nZXQoJ3RpbWUnKX1dIHtlLmdldCgnc2VuZGVyJyl9OiB7ZS5nZXQoJ21lc3NhZ2UnKX1cbiIpCiAgICAgICAgcHJpbnQoZiLinIUgUml3YXlhdCBiZXJoYXNpbCBkaXNpbXBhbiBrZSAne2ZuYW1lfSciKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleDoKICAgICAgICBwcmludCgiR2FnYWwgZXhwb3J0OiIsIGV4KQoKZGVmIGxvYWRfZmlsZV90ZXh0KHBhdGgsIGRlZmF1bHQ9IiIpOgogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgcmV0dXJuIGYucmVhZCgpLnN0cmlwKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICByZXR1cm4gZGVmYXVsdAoKZGVmIHNhdmVfZmlsZV90ZXh0KHBhdGgsIHR4dCk6CiAgICB0cnk6CiAgICAgICAgZW5zdXJlX2Rpcl9mb3IocGF0aCkKICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKHN0cih0eHQpKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCiMgPT09PT0gRGlzY292ZXJ5ID09PT09CmRlZiBicm9hZGNhc3Rfc2VydmVyX3ByZXNlbmNlKHN0b3BfZXZlbnQsIHNlcnZlcl9pcCwgcG9ydD1DSEFUX1BPUlQsIGludGVydmFsPURJU0NfSU5URVJWQUwpOgogICAgcyA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX0RHUkFNKQogICAgcy5zZXRzb2Nrb3B0KHNvY2tldC5TT0xfU09DS0VULCBzb2NrZXQuU09fQlJPQURDQVNULCAxKQogICAgbXNnID0ganNvbi5kdW1wcyh7Im1hZ2ljIjogRElTQ19NQUdJQywgImlwIjogc2VydmVyX2lwLCAicG9ydCI6IHBvcnR9KS5lbmNvZGUoInV0Zi04IikKICAgIHdoaWxlIG5vdCBzdG9wX2V2ZW50LmlzX3NldCgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcy5zZW5kdG8obXNnLCAoJzI1NS4yNTUuMjU1LjI1NScsIERJU0NfUE9SVCkpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgdGltZS5zbGVlcChpbnRlcnZhbCkKICAgIHRyeToKICAgICAgICBzLmNsb3NlKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgbGlzdGVuX2Zvcl9zZXJ2ZXIoZGlzY292ZXJlZF9saXN0LCBzdG9wX2V2ZW50LCB0aW1lb3V0PURJU0NfVElNRU9VVCk6CiAgICBzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfREdSQU0pCiAgICBzLnNldHNvY2tvcHQoc29ja2V0LlNPTF9TT0NLRVQsIHNvY2tldC5TT19SRVVTRUFERFIsIDEpCiAgICB0cnk6CiAgICAgICAgcy5iaW5kKCgnJywgRElTQ19QT1JUKSkKICAgIGV4Y2VwdDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHMuYmluZCgoJzAuMC4wLjAnLCBESVNDX1BPUlQpKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgcy5zZXR0aW1lb3V0KDAuOCkKICAgIHN0YXJ0ID0gdGltZS50aW1lKCkKICAgIHdoaWxlIHRpbWUudGltZSgpIC0gc3RhcnQgPCB0aW1lb3V0IGFuZCBub3Qgc3RvcF9ldmVudC5pc19zZXQoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRhdGEsIGFkZHIgPSBzLnJlY3Zmcm9tKDEwMjQpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMoZGF0YS5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSkKICAgICAgICAgICAgICAgIGlmIG9iai5nZXQoIm1hZ2ljIikgPT0gRElTQ19NQUdJQzoKICAgICAgICAgICAgICAgICAgICBpcCA9IG9iai5nZXQoImlwIikgb3IgYWRkclswXQogICAgICAgICAgICAgICAgICAgIHBvcnQgPSBpbnQob2JqLmdldCgicG9ydCIpIG9yIENIQVRfUE9SVCkKICAgICAgICAgICAgICAgICAgICBkaXNjb3ZlcmVkX2xpc3QuYXBwZW5kKChpcCwgcG9ydCkpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBleGNlcHQgc29ja2V0LnRpbWVvdXQ6CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBicmVhawogICAgdHJ5OgogICAgICAgIHMuY2xvc2UoKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCiMgPT09PT0gQ2hhdCBTZXJ2ZXIgPT09PT0KY2xhc3MgQ2hhdFNlcnZlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBob3N0X2lwPSIiLCBwb3J0PUNIQVRfUE9SVCwgdGhlbWU9Tm9uZSk6CiAgICAgICAgc2VsZi5ob3N0X2lwID0gaG9zdF9pcCBvciBzZWxmLl9nZXRfbG9jYWxfaXAoKQogICAgICAgIHNlbGYucG9ydCA9IHBvcnQKICAgICAgICBzZWxmLnNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgc2VsZi5zb2NrLnNldHNvY2tvcHQoc29ja2V0LlNPTF9TT0NLRVQsIHNvY2tldC5TT19SRVVTRUFERFIsIDEpCiAgICAgICAgc2VsZi5jbGllbnRzID0ge30gICAjIGNvbm4gLT4geyJuaWNrIjouLi4sICJhZGRyIjouLi4sICJmaWxlIjouLi59CiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICBzZWxmLmJjYXN0X3N0b3AgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgICAgIHNlbGYuYWRtaW5fbmljayA9IGxvYWRfZmlsZV90ZXh0KE5JQ0tfRklMRSwgIiIpLnN0cmlwKCkgb3IgZiJhZG1pbntyYW5kb20ucmFuZGludCgxMCw5OSl9IgogICAgICAgIHNlbGYudGhlbWUgPSB0aGVtZSBvciBUSEVNRVMuZ2V0KERFRkFVTFRfVEhFTUVfS0VZLCBUSEVNRVNbIjEiXSkKCiAgICBkZWYgc3RhcnQoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLnNvY2suYmluZCgoJycsIHNlbGYucG9ydCkpCiAgICAgICAgICAgIHNlbGYuc29jay5saXN0ZW4oNTApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludCgiR2FnYWwgYmluZC9saXN0ZW46IiwgZSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQogICAgICAgIHRpdGxlX2NvbCA9IHNlbGYudGhlbWVbMV0KICAgICAgICByZXNldCA9IFN0eWxlLlJFU0VUX0FMTAogICAgICAgIHByaW50KGYiXG57dGl0bGVfY29sffCflKUgQml0Y2hhdCB7VkVSU0lPTn0g4oCUIFNlcnZlciBzdGFydGVkIG9uIHtzZWxmLmhvc3RfaXB9OntzZWxmLnBvcnR9e3Jlc2V0fSIpCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9YnJvYWRjYXN0X3NlcnZlcl9wcmVzZW5jZSwgYXJncz0oc2VsZi5iY2FzdF9zdG9wLCBzZWxmLmhvc3RfaXAsIHNlbGYucG9ydCksIGRhZW1vbj1UcnVlKS5zdGFydCgpCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fYWNjZXB0X2xvb3AsIGRhZW1vbj1UcnVlKS5zdGFydCgpCiAgICAgICAgc2VsZi5fYWRtaW5fY29uc29sZSgpCgogICAgZGVmIF9hZG1pbl9jb25zb2xlKHNlbGYpOgogICAgICAgIGluZm9fY29sID0gc2VsZi50aGVtZVsyXQogICAgICAgIHJlc2V0ID0gU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgcHJpbnQoZiJcbntpbmZvX2NvbH1LZXRpayAvaGVscCB1bnR1ayBtZWxpaGF0IGRhZnRhciBwZXJpbnRhaCBhZG1pbi57cmVzZXR9IikKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBsaW5lID0gaW5wdXQoKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBub3QgbGluZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgaWYgbGluZS5zdGFydHN3aXRoKCIvIik6CiAgICAgICAgICAgICAgICAgICAgY21kID0gbGluZS5zcGxpdCgiICIsIDEpCiAgICAgICAgICAgICAgICAgICAgYyA9IGNtZFswXQogICAgICAgICAgICAgICAgICAgIGlmIGMgPT0gIi93aG8iOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jbWRfd2hvKCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGMgPT0gIi9raWNrIjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNtZCkgPiAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fY21kX2tpY2soY21kWzFdLnN0cmlwKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiR3VuYWthbjogL2tpY2sgPG5pY2s+IikKICAgICAgICAgICAgICAgICAgICBlbGlmIGMgPT0gIi9zYXZlY2hhdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydF9jaGF0X2ZpbGUoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgYyA9PSAiL2hlbHAiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaG93X2hlbHAoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgYyA9PSAiL2V4aXQiOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiTWVudXR1cCBzZXJ2ZXIuLi4iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJQZXJpbnRhaCB0aWRhayBkaWtlbmFsLiBLZXRpayAvaGVscC4iKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhZG1pbl9kaXNwbGF5ID0gZiJbYWRtaW5dIHtzZWxmLmFkbWluX25pY2t9IgogICAgICAgICAgICAgICAgICAgIGVudHJ5ID0geyJ0aW1lIjogbm93X3RzKCksICJzZW5kZXIiOiBhZG1pbl9kaXNwbGF5LCAibWVzc2FnZSI6IGxpbmV9CiAgICAgICAgICAgICAgICAgICAgc2F2ZV9tZXNzYWdlX2xvY2FsKGVudHJ5KQogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Jyb2FkY2FzdF9hbGwoeyJ0eXBlIjogIm1zZyIsICJuaWNrIjogYWRtaW5fZGlzcGxheSwgInRleHQiOiBsaW5lfSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlt7bm93X3RzKCclSDolTScpfV0gW3thZG1pbl9kaXNwbGF5fV0ge2xpbmV9IikKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBzZWxmLnN0b3AoKQoKICAgIGRlZiBzdG9wKHNlbGYpOgogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5iY2FzdF9zdG9wLnNldCgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIF9sb2NrOgogICAgICAgICAgICAgICAgZm9yIGNvbm4gaW4gbGlzdChzZWxmLmNsaWVudHMua2V5cygpKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBzZWxmLnNvY2suY2xvc2UoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIHByaW50KCJTZXJ2ZXIgYmVyaGVudGkuIikKCiAgICBkZWYgX2FjY2VwdF9sb29wKHNlbGYpOgogICAgICAgIHdoaWxlIHNlbGYucnVubmluZzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY29ubiwgYWRkciA9IHNlbGYuc29jay5hY2NlcHQoKQogICAgICAgICAgICAgICAgZiA9IGNvbm4ubWFrZWZpbGUobW9kZT0icndiIikKICAgICAgICAgICAgICAgIHdpdGggX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jbGllbnRzW2Nvbm5dID0geyJuaWNrIjogZiJ7YWRkclswXX0iLCAiYWRkciI6IGFkZHIsICJmaWxlIjogZn0KICAgICAgICAgICAgICAgIHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX2NsaWVudF90aHJlYWQsIGFyZ3M9KGNvbm4sIGYsIGFkZHIpLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjA1KQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICBkZWYgX2NsaWVudF90aHJlYWQoc2VsZiwgY29ubiwgZmlsZW9iaiwgYWRkcik6CiAgICAgICAgaXAgPSBhZGRyWzBdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsaW5lID0gZmlsZW9iai5yZWFkbGluZSgpCiAgICAgICAgICAgIGlmIG5vdCBsaW5lOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMobGluZS5kZWNvZGUoInV0Zi04Iikuc3RyaXAoKSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGlmIG9iai5nZXQoInR5cGUiKSA9PSAiam9pbiI6CiAgICAgICAgICAgICAgICBuaWNrID0gb2JqLmdldCgibmljayIpIG9yIGlwCiAgICAgICAgICAgICAgICB3aXRoIF9sb2NrOgogICAgICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50c1tjb25uXVsibmljayJdID0gbmljawogICAgICAgICAgICAgICAgc2VsZi5fYnJvYWRjYXN0X2FsbCh7InR5cGUiOiAic3lzdGVtIiwgInRleHQiOiBmIntuaWNrfSBiZXJnYWJ1bmcuIn0pCiAgICAgICAgICAgICAgICBzZWxmLl9zZW5kX2NsaWVudF9saXN0KGNvbm4pCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICBsaW5lID0gZmlsZW9iai5yZWFkbGluZSgpCiAgICAgICAgICAgICAgICBpZiBub3QgbGluZToKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9iaiA9IGpzb24ubG9hZHMobGluZS5kZWNvZGUoInV0Zi04Iikuc3RyaXAoKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgbXR5cGUgPSBvYmouZ2V0KCJ0eXBlIikKICAgICAgICAgICAgICAgIGlmIG10eXBlID09ICJtc2ciOgogICAgICAgICAgICAgICAgICAgIG5pY2sgPSBzZWxmLmNsaWVudHMuZ2V0KGNvbm4sIHt9KS5nZXQoIm5pY2siLCBpcCkKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gb2JqLmdldCgidGV4dCIsICIiKQogICAgICAgICAgICAgICAgICAgIGVudHJ5ID0geyJ0aW1lIjogbm93X3RzKCksICJzZW5kZXIiOiBuaWNrLCAibWVzc2FnZSI6IHRleHR9CiAgICAgICAgICAgICAgICAgICAgc2F2ZV9tZXNzYWdlX2xvY2FsKGVudHJ5KQogICAgICAgICAgICAgICAgICAgIHNlbGYuX2Jyb2FkY2FzdF9leGNlcHQoY29ubiwgeyJ0eXBlIjogIm1zZyIsICJuaWNrIjogbmljaywgInRleHQiOiB0ZXh0fSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxuW3tub3dfdHMoJyVIOiVNJyl9XSBbe25pY2t9XSB7dGV4dH0iKQogICAgICAgICAgICAgICAgZWxpZiBtdHlwZSA9PSAibmljayI6CiAgICAgICAgICAgICAgICAgICAgb2xkID0gc2VsZi5jbGllbnRzLmdldChjb25uLCB7fSkuZ2V0KCJuaWNrIiwgaXApCiAgICAgICAgICAgICAgICAgICAgbmV3ID0gb2JqLmdldCgibmljayIpIG9yIG9sZAogICAgICAgICAgICAgICAgICAgIHdpdGggX2xvY2s6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50c1tjb25uXVsibmljayJdID0gbmV3CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fYnJvYWRjYXN0X2FsbCh7InR5cGUiOiAic3lzdGVtIiwgInRleHQiOiBmIntvbGR9IGdhbnRpIG5pY2tuYW1lIC0+IHtuZXd9In0pCiAgICAgICAgICAgICAgICBlbGlmIG10eXBlID09ICJ3aG8iOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmRfY2xpZW50X2xpc3QoY29ubikKICAgICAgICAgICAgICAgIGVsaWYgbXR5cGUgPT0gImV4aXQiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIG5pY2sgPSBzZWxmLmNsaWVudHMuZ2V0KGNvbm4sIHt9KS5nZXQoIm5pY2siLCBpcCkKICAgICAgICAgICAgc2VsZi5fZGlzY29ubmVjdF9jbGllbnQoY29ubiwgbmljaywgIm1lbnV0dXAga29uZWtzaSIpCgogICAgZGVmIF9kaXNjb25uZWN0X2NsaWVudChzZWxmLCBjb25uLCBuaWNrLCByZWFzb24pOgogICAgICAgIHRyeToKICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgd2l0aCBfbG9jazoKICAgICAgICAgICAgaWYgY29ubiBpbiBzZWxmLmNsaWVudHM6CiAgICAgICAgICAgICAgICBkZWwgc2VsZi5jbGllbnRzW2Nvbm5dCiAgICAgICAgc2VsZi5fYnJvYWRjYXN0X2FsbCh7InR5cGUiOiAic3lzdGVtIiwgInRleHQiOiBmIuKaoO+4jyB7bmlja30ge3JlYXNvbn0uIn0pCiAgICAgICAgcHJpbnQoZiLimqDvuI8ge25pY2t9IHtyZWFzb259LiIpCgogICAgZGVmIF9icm9hZGNhc3RfYWxsKHNlbGYsIG9iaik6CiAgICAgICAgZGF0YSA9IChqc29uLmR1bXBzKG9iaiwgZW5zdXJlX2FzY2lpPUZhbHNlKSArICJcbiIpLmVuY29kZSgidXRmLTgiKQogICAgICAgIHdpdGggX2xvY2s6CiAgICAgICAgICAgIGZvciBjb25uIGluIGxpc3Qoc2VsZi5jbGllbnRzLmtleXMoKSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY29ubi5zZW5kYWxsKGRhdGEpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwoKICAgIGRlZiBfYnJvYWRjYXN0X2V4Y2VwdChzZWxmLCBleGNlcHRfY29ubiwgb2JqKToKICAgICAgICBkYXRhID0gKGpzb24uZHVtcHMob2JqLCBlbnN1cmVfYXNjaWk9RmFsc2UpICsgIlxuIikuZW5jb2RlKCJ1dGYtOCIpCiAgICAgICAgd2l0aCBfbG9jazoKICAgICAgICAgICAgZm9yIGNvbm4gaW4gbGlzdChzZWxmLmNsaWVudHMua2V5cygpKToKICAgICAgICAgICAgICAgIGlmIGNvbm4gaXMgZXhjZXB0X2Nvbm46CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjb25uLnNlbmRhbGwoZGF0YSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgZGVmIF9zZW5kX2NsaWVudF9saXN0KHNlbGYsIGNvbm4pOgogICAgICAgIHdpdGggX2xvY2s6CiAgICAgICAgICAgIG5hbWVzID0gW2luZm8uZ2V0KCJuaWNrIikgZm9yIGluZm8gaW4gc2VsZi5jbGllbnRzLnZhbHVlcygpXQogICAgICAgIHRyeToKICAgICAgICAgICAgY29ubi5zZW5kYWxsKChqc29uLmR1bXBzKHsidHlwZSI6ICJ3aG8iLCAibGlzdCI6IG5hbWVzfSwgZW5zdXJlX2FzY2lpPUZhbHNlKSArICJcbiIpLmVuY29kZSgidXRmLTgiKSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgX2NtZF93aG8oc2VsZik6CiAgICAgICAgd2l0aCBfbG9jazoKICAgICAgICAgICAgbmFtZXMgPSBbZiJ7aW5mby5nZXQoJ25pY2snKX1Ae2luZm8uZ2V0KCdhZGRyJylbMF19IiBmb3IgaW5mbyBpbiBzZWxmLmNsaWVudHMudmFsdWVzKCldCiAgICAgICAgcHJpbnQoIvCfkaUgT25saW5lOiIpCiAgICAgICAgZm9yIG4gaW4gbmFtZXM6CiAgICAgICAgICAgIHByaW50KCIgLSIsIG4pCgogICAgZGVmIF9jbWRfa2ljayhzZWxmLCBuaWNrKToKICAgICAgICB0YXJnZXQgPSBOb25lCiAgICAgICAgd2l0aCBfbG9jazoKICAgICAgICAgICAgZm9yIGMsIGluZm8gaW4gc2VsZi5jbGllbnRzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBpbmZvLmdldCgibmljayIpID09IG5pY2s6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gYwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgdGFyZ2V0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0YXJnZXQuc2VuZGFsbCgoanNvbi5kdW1wcyh7InR5cGUiOiAia2ljayIsICJ0ZXh0IjogIvCfmqsgQW5kYSB0ZWxhaCBkaXRlbmRhbmcgb2xlaCBhZG1pbiEifSwgZW5zdXJlX2FzY2lpPUZhbHNlKSArICJcbiIpLmVuY29kZSgidXRmLTgiKSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBzZWxmLl9kaXNjb25uZWN0X2NsaWVudCh0YXJnZXQsIG5pY2ssICJ0ZWxhaCBkaXRlbmRhbmcgb2xlaCBhZG1pbiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiLinYwgVGlkYWsgZGl0ZW11a2FuIHVzZXIgYmVybmFtYSB7bmlja30iKQoKICAgIGRlZiBfc2hvd19oZWxwKHNlbGYpOgogICAgICAgIGluZm9fY29sID0gc2VsZi50aGVtZVsyXQogICAgICAgIHJlc2V0ID0gU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgcHJpbnQoZiIiIiAgIHtpbmZvX2NvbH09PT0gUEVSSU5UQUggQURNSU4gPT09e3Jlc2V0fQovd2hvICAgICAgICDigJQgTGloYXQgc2lhcGEgeWFuZyBvbmxpbmUKL2tpY2sgICAgICAg4oCUIFRlbmRhbmcgdXNlciB0ZXJ0ZW50dQovc2F2ZWNoYXQgICDigJQgU2ltcGFuIHJpd2F5YXQKL2hlbHAgICAgICAg4oCUIExpaGF0IGRhZnRhciBwZXJpbnRhaAovZXhpdCAgICAgICDigJQgVHV0dXAgc2VydmVyCiIiIikKCiAgICBkZWYgX2dldF9sb2NhbF9pcChzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHMgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19ER1JBTSkKICAgICAgICAgICAgcy5jb25uZWN0KCgiOC44LjguOCIsIDgwKSkKICAgICAgICAgICAgaXAgPSBzLmdldHNvY2tuYW1lKClbMF0KICAgICAgICAgICAgcy5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiBpcAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuICIwLjAuMC4wIgoKIyA9PT09PSBDbGllbnQgPT09PT0KY2xhc3MgQ2hhdENsaWVudDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzZXJ2ZXJfaXAsIHNlcnZlcl9wb3J0PUNIQVRfUE9SVCwgdGhlbWU9Tm9uZSk6CiAgICAgICAgc2VsZi5zZXJ2ZXJfaXAgPSBzZXJ2ZXJfaXAKICAgICAgICBzZWxmLnNlcnZlcl9wb3J0ID0gc2VydmVyX3BvcnQKICAgICAgICBzZWxmLnNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgc2VsZi5maWxlID0gTm9uZQogICAgICAgIHNlbGYubmljayA9IGxvYWRfZmlsZV90ZXh0KE5JQ0tfRklMRSwgIiIpLnN0cmlwKCkgb3IgTm9uZQogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi50aGVtZSA9IHRoZW1lIG9yIFRIRU1FUy5nZXQoREVGQVVMVF9USEVNRV9LRVksIFRIRU1FU1siMSJdKQoKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuc29jay5jb25uZWN0KChzZWxmLnNlcnZlcl9pcCwgc2VsZi5zZXJ2ZXJfcG9ydCkpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludCgiR2FnYWwga29uZWsga2Ugc2VydmVyOiIsIGUpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlbGYuZmlsZSA9IHNlbGYuc29jay5tYWtlZmlsZShtb2RlPSJyd2IiKQogICAgICAgIGlmIG5vdCBzZWxmLm5pY2s6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYubmljayA9IGlucHV0KCJNYXN1a2thbiBuaWNrbmFtZSBBbmRhOiAiKS5zdHJpcCgpIG9yIGYiYW5vbntyYW5kb20ucmFuZGludCgxMDAsOTk5KX0iCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHNlbGYubmljayA9IGYiYW5vbntyYW5kb20ucmFuZGludCgxMDAsOTk5KX0iCiAgICAgICAgc2F2ZV9maWxlX3RleHQoTklDS19GSUxFLCBzZWxmLm5pY2spCiAgICAgICAgc2VsZi5fc2VuZCh7InR5cGUiOiAiam9pbiIsICJuaWNrIjogc2VsZi5uaWNrfSkKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCiAgICAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fcmVjdl9sb29wLCBkYWVtb249VHJ1ZSkuc3RhcnQoKQogICAgICAgIHRpdGxlX2NvbCA9IHNlbGYudGhlbWVbMV07IGluZm9fY29sID0gc2VsZi50aGVtZVsyXTsgcmVzZXQgPSBTdHlsZS5SRVNFVF9BTEwKICAgICAgICBwcmludChmInt0aXRsZV9jb2x94pyFIFRlcmh1YnVuZyBrZSB7c2VsZi5zZXJ2ZXJfaXB9OntzZWxmLnNlcnZlcl9wb3J0fSBzZWJhZ2FpIHtzZWxmLm5pY2t9e3Jlc2V0fSIpCiAgICAgICAgcHJpbnQoZiJ7aW5mb19jb2x9S2V0aWsgL2hlbHAgdW50dWsgbWVsaWhhdCBkYWZ0YXIgcGVyaW50YWgue3Jlc2V0fSIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aGlsZSBzZWxmLnJ1bm5pbmc6CiAgICAgICAgICAgICAgICBtc2cgPSBpbnB1dCgiS2FtdTogIikuc3RyaXAoKQogICAgICAgICAgICAgICAgaWYgbm90IG1zZzoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgaWYgbXNnID09ICIvZXhpdCI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VuZCh7InR5cGUiOiAiZXhpdCJ9KQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIG1zZy5zdGFydHN3aXRoKCIvbmljayAiKToKICAgICAgICAgICAgICAgICAgICBuZXcgPSBtc2cuc3BsaXQoIiAiLCAxKVsxXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgaWYgbmV3OgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm5pY2sgPSBuZXcKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZV9maWxlX3RleHQoTklDS19GSUxFLCBzZWxmLm5pY2spCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmQoeyJ0eXBlIjogIm5pY2siLCAibmljayI6IG5ld30pCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYi4pyFIE5pY2sgZGl1YmFoIGphZGkge25ld30iKQogICAgICAgICAgICAgICAgZWxpZiBtc2cgPT0gIi93aG8iOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlbmQoeyJ0eXBlIjogIndobyJ9KQogICAgICAgICAgICAgICAgZWxpZiBtc2cgPT0gIi9zYXZlY2hhdCI6CiAgICAgICAgICAgICAgICAgICAgZXhwb3J0X2NoYXRfZmlsZSgpCiAgICAgICAgICAgICAgICBlbGlmIG1zZyA9PSAiL2NsZWFyIjoKICAgICAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oImNscyIgaWYgb3MubmFtZSA9PSAibnQiIGVsc2UgImNsZWFyIikKICAgICAgICAgICAgICAgIGVsaWYgbXNnID09ICIvaGVscCI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2hvd19oZWxwKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VuZCh7InR5cGUiOiAibXNnIiwgInRleHQiOiBtc2d9KQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiW3tub3dfdHMoJyVIOiVNJyl9XSBbe3NlbGYubmlja31dIHttc2d9IikKICAgICAgICAgICAgICAgICAgICBzYXZlX21lc3NhZ2VfbG9jYWwoeyJ0aW1lIjogbm93X3RzKCksICJzZW5kZXIiOiBzZWxmLm5pY2ssICJtZXNzYWdlIjogbXNnfSkKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLnNvY2suY2xvc2UoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHByaW50KCJLb25la3NpIGRpdHV0dXAuIikKCiAgICBkZWYgX3NlbmQoc2VsZiwgb2JqKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuc29jay5zZW5kYWxsKChqc29uLmR1bXBzKG9iaiwgZW5zdXJlX2FzY2lpPUZhbHNlKSArICJcbiIpLmVuY29kZSgidXRmLTgiKSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgX3JlY3ZfbG9vcChzZWxmKToKICAgICAgICBmID0gc2VsZi5maWxlCiAgICAgICAgbXNnX2NvbCA9IHNlbGYudGhlbWVbM107IHN5c19jb2wgPSBzZWxmLnRoZW1lWzRdOyByZXNldCA9IFN0eWxlLlJFU0VUX0FMTAogICAgICAgIHdoaWxlIHNlbGYucnVubmluZzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbGluZSA9IGYucmVhZGxpbmUoKQogICAgICAgICAgICAgICAgaWYgbm90IGxpbmU6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvYmogPSBqc29uLmxvYWRzKGxpbmUuZGVjb2RlKCJ1dGYtOCIpLnN0cmlwKCkpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIG10eXBlID0gb2JqLmdldCgidHlwZSIpCiAgICAgICAgICAgICAgICBpZiBtdHlwZSA9PSAibXNnIjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue21zZ19jb2x9W3tub3dfdHMoJyVIOiVNJyl9XSBbe29iai5nZXQoJ25pY2snKX1dIHtvYmouZ2V0KCd0ZXh0Jyl9e3Jlc2V0fSIpCiAgICAgICAgICAgICAgICAgICAgc2F2ZV9tZXNzYWdlX2xvY2FsKHsidGltZSI6IG5vd190cygpLCAic2VuZGVyIjogb2JqLmdldCgibmljayIpLCAibWVzc2FnZSI6IG9iai5nZXQoInRleHQiKX0pCiAgICAgICAgICAgICAgICBlbGlmIG10eXBlID09ICJzeXN0ZW0iOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57c3lzX2NvbH1be25vd190cygnJUg6JU0nKX1dIFtTWVNURU1dIHtvYmouZ2V0KCd0ZXh0Jyl9e3Jlc2V0fSIpCiAgICAgICAgICAgICAgICAgICAgc2F2ZV9tZXNzYWdlX2xvY2FsKHsidGltZSI6IG5vd190cygpLCAic2VuZGVyIjogIlNZU1RFTSIsICJtZXNzYWdlIjogb2JqLmdldCgidGV4dCIpfSkKICAgICAgICAgICAgICAgIGVsaWYgbXR5cGUgPT0gIndobyI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbvCfkaUgT25saW5lOiB7JywgJy5qb2luKG9iai5nZXQoJ2xpc3QnLCBbXSkpfSIpCiAgICAgICAgICAgICAgICBlbGlmIG10eXBlID09ICJraWNrIjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0ZvcmUuUkVEfXtvYmouZ2V0KCd0ZXh0Jyl9e3Jlc2V0fSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgwLjA1KQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBwcmludCgi4pqg77iPIFRlcnB1dHVzIGRhcmkgc2VydmVyLiIpCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKCiAgICBkZWYgX3Nob3dfaGVscChzZWxmKToKICAgICAgICBpbmZvX2NvbCA9IHNlbGYudGhlbWVbMl07IHJlc2V0ID0gU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgcHJpbnQoZiIiIiAgIHtpbmZvX2NvbH09PT0gUEVSSU5UQUggQ0xJRU5UID09PXtyZXNldH0KL25pY2sgIOKAlCBHYW50aSBuaWNrbmFtZQovd2hvICAg4oCUIExpaGF0IHNpYXBhIHlhbmcgb25saW5lCi9zYXZlY2hhdCDigJQgU2ltcGFuIHJpd2F5YXQKL2NsZWFyIOKAlCBCZXJzaWhrYW4gbGF5YXIKL2hlbHAgIOKAlCBMaWhhdCBwZXJpbnRhaAovZXhpdCAg4oCUIEtlbHVhciBkYXJpIGNoYXQKIiIiKQoKIyA9PT09PSBNQUlOICYgVEhFTUUgU0VMRUNUSU9OID09PT09CmRlZiBjaG9vc2VfdGhlbWUoKToKICAgIHByaW50KCJcbj09PSBQaWxpaCBUZW1hID09PSIpCiAgICBmb3IgaywgdiBpbiBUSEVNRVMuaXRlbXMoKToKICAgICAgICBwcmludChmIntrfS4ge3ZbMF19IikKICAgIGNoID0gaW5wdXQoIlBpbGloIG5vbW9yIHRlbWEgWzEtNV06ICIpLnN0cmlwKCkKICAgIGlmIGNoIG5vdCBpbiBUSEVNRVM6CiAgICAgICAgY2ggPSBERUZBVUxUX1RIRU1FX0tFWQogICAgc2F2ZV9maWxlX3RleHQoVEhFTUVfRklMRSwgY2gpCiAgICByZXR1cm4gVEhFTUVTW2NoXQoKZGVmIGdldF9sb2NhbF9pcCgpOgogICAgdHJ5OgogICAgICAgIHMgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19ER1JBTSkKICAgICAgICBzLmNvbm5lY3QoKCI4LjguOC44IiwgODApKQogICAgICAgIGlwID0gcy5nZXRzb2NrbmFtZSgpWzBdCiAgICAgICAgcy5jbG9zZSgpCiAgICAgICAgcmV0dXJuIGlwCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuICIwLjAuMC4wIgoKZGVmIHByaW50X3N0YXJ0dXAodGhlbWUpOgogICAgdGl0bGVfY29sID0gdGhlbWVbMV0KICAgIHJlc2V0ID0gU3R5bGUuUkVTRVRfQUxMCiAgICB0cnk6CiAgICAgICAgaWYgcHlmaWdsZXQ6CiAgICAgICAgICAgIGFydCA9IHB5ZmlnbGV0LmZpZ2xldF9mb3JtYXQoIkJpdGNoYXQiLCBmb250PSJzbGFudCIpCiAgICAgICAgICAgIHByaW50KHRpdGxlX2NvbCArIGFydCArIHJlc2V0KQogICAgICAgICAgICAjIEFEREVEOiBDcmVhdGUgYnkgTXIuWCBkaXJlY3RseSB1bmRlciB0aGUgQVNDSUkgYXJ0CiAgICAgICAgICAgIHByaW50KHRpdGxlX2NvbCArICIgICAgICAgPD09Q3JlYXRlIGJ5IE1yLlg9PT4iICsgcmVzZXQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQodGl0bGVfY29sICsgZiJCaXRjaGF0IC0ge1ZFUlNJT059IiArIHJlc2V0KQogICAgICAgICAgICAjIHN0aWxsIHNob3cgdGhlIENyZWF0ZSBieSBsaW5lIGV2ZW4gd2l0aG91dCBmaWdsZXQKICAgICAgICAgICAgcHJpbnQodGl0bGVfY29sICsgIkNyZWF0ZSBieSBNci5YIiArIHJlc2V0KQogICAgZXhjZXB0OgogICAgICAgIHByaW50KGYiQml0Y2hhdCAtIHtWRVJTSU9OfSIpCiAgICAgICAgcHJpbnQoIkNyZWF0ZSBieSBNci5YIikKCmRlZiBtYWluKCk6CiAgICBwID0gYXJncGFyc2UuQXJndW1lbnRQYXJzZXIoKQogICAgcC5hZGRfYXJndW1lbnQoIi0tbW9kZSIsIGNob2ljZXM9WyJhdXRvIiwgInNlcnZlciIsICJjbGllbnQiXSwgZGVmYXVsdD0iYXV0byIpCiAgICBwLmFkZF9hcmd1bWVudCgiLS1zZXJ2ZXItaXAiLCBoZWxwPSJpZiBtb2RlPWNsaWVudCIpCiAgICBwLmFkZF9hcmd1bWVudCgiLS1jaGF0LXBvcnQiLCB0eXBlPWludCwgZGVmYXVsdD1DSEFUX1BPUlQpCiAgICBwLmFkZF9hcmd1bWVudCgiLS1kaXNjLXRpbWVvdXQiLCB0eXBlPWludCwgZGVmYXVsdD1ESVNDX1RJTUVPVVQpCiAgICBhcmdzID0gcC5wYXJzZV9hcmdzKCkKCiAgICB0aGVtZV9rZXkgPSBsb2FkX2ZpbGVfdGV4dChUSEVNRV9GSUxFLCBERUZBVUxUX1RIRU1FX0tFWSkKICAgIHRoZW1lID0gVEhFTUVTLmdldCh0aGVtZV9rZXksIFRIRU1FUy5nZXQoREVGQVVMVF9USEVNRV9LRVkpKQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKFRIRU1FX0ZJTEUpOgogICAgICAgIHRoZW1lID0gY2hvb3NlX3RoZW1lKCkKCiAgICBwcmludF9zdGFydHVwKHRoZW1lKQoKICAgIGlmIGFyZ3MubW9kZSA9PSAiY2xpZW50IiBhbmQgbm90IGFyZ3Muc2VydmVyX2lwOgogICAgICAgIHByaW50KCJNb2RlIGNsaWVudCBtZW1idXR1aGthbiAtLXNlcnZlci1pcCIpCiAgICAgICAgcmV0dXJuCgogICAgaWYgYXJncy5tb2RlID09ICJzZXJ2ZXIiOgogICAgICAgIHNlcnZlciA9IENoYXRTZXJ2ZXIoaG9zdF9pcD1nZXRfbG9jYWxfaXAoKSwgcG9ydD1hcmdzLmNoYXRfcG9ydCwgdGhlbWU9dGhlbWUpCiAgICAgICAgc2VydmVyLnN0YXJ0KCkKICAgICAgICByZXR1cm4KCiAgICBpZiBhcmdzLm1vZGUgPT0gImNsaWVudCI6CiAgICAgICAgY2xpZW50ID0gQ2hhdENsaWVudChhcmdzLnNlcnZlcl9pcCwgYXJncy5jaGF0X3BvcnQsIHRoZW1lPXRoZW1lKQogICAgICAgIGNsaWVudC5zdGFydCgpCiAgICAgICAgcmV0dXJuCgogICAgIyBhdXRvIGRpc2NvdmVyeQogICAgcHJpbnQoZiJNZW5jYXJpIHNlcnZlciBkaSBqYXJpbmdhbiAobWVudW5nZ3Uge2FyZ3MuZGlzY190aW1lb3V0fSBkZXRpaykuLi4iKQogICAgZGlzY292ZXJlZCA9IFtdCiAgICBzdG9wX2V2dCA9IHRocmVhZGluZy5FdmVudCgpCiAgICBsaXN0ZW5lciA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWxpc3Rlbl9mb3Jfc2VydmVyLCBhcmdzPShkaXNjb3ZlcmVkLCBzdG9wX2V2dCwgYXJncy5kaXNjX3RpbWVvdXQpLCBkYWVtb249VHJ1ZSkKICAgIGxpc3RlbmVyLnN0YXJ0KCkKICAgIGxpc3RlbmVyLmpvaW4odGltZW91dD1hcmdzLmRpc2NfdGltZW91dCArIDAuNSkKICAgIHN0b3BfZXZ0LnNldCgpCiAgICBpZiBkaXNjb3ZlcmVkOgogICAgICAgIHNlcnZlcl9pcCwgc2VydmVyX3BvcnQgPSBkaXNjb3ZlcmVkWzBdCiAgICAgICAgcHJpbnQoZiJTZXJ2ZXIgZGl0ZW11a2FuOiB7c2VydmVyX2lwfTp7c2VydmVyX3BvcnR9LiBNZW5qYWRpIGNsaWVudC4uLiIpCiAgICAgICAgY2xpZW50ID0gQ2hhdENsaWVudChzZXJ2ZXJfaXAsIHNlcnZlcl9wb3J0LCB0aGVtZT10aGVtZSkKICAgICAgICBjbGllbnQuc3RhcnQoKQogICAgICAgIHJldHVybgoKICAgICMgbm9uZSAtPiBiZWNvbWUgc2VydmVyCiAgICBwcmludCgiVGlkYWsgbWVuZW11a2FuIHNlcnZlci4gTWVuamFkaSBzZXJ2ZXIgb3RvbWF0aXMuLi4iKQogICAgc2VydmVyID0gQ2hhdFNlcnZlcihob3N0X2lwPWdldF9sb2NhbF9pcCgpLCBwb3J0PWFyZ3MuY2hhdF9wb3J0LCB0aGVtZT10aGVtZSkKICAgIHNlcnZlci5zdGFydCgpCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgbWFpbigp').decode('utf-8'))
